# [tox].envlist generated by update_config.py using pre-commit, toml reformatted
[tox]
envlist = {py38,py39,py310,py311}-bodhilib{0_1_11}

[testenv]
allowlist_externals = 
	sed
	mv
	echo
	sh
	poetry
	git
deps = 
	poetry
pass_env = 
	BODHILIB_VERSION
	PLUGIN_DIR
commands_pre = 
	echo "Plugin directory is: {env:PLUGIN_DIR}"
	poetry check --lock --directory {env:PLUGIN_DIR}
	sh -c 'sed "s/^bodhilib =.*/bodhilib = \"=={env:BODHILIB_VERSION}\"/" {env:PLUGIN_DIR}/pyproject.toml > {env:PLUGIN_DIR}/pyproject_temp.toml'
	mv {env:PLUGIN_DIR}/pyproject_temp.toml {env:PLUGIN_DIR}/pyproject.toml
	poetry lock --no-update --directory {env:PLUGIN_DIR}
	poetry install --sync --with main --with test --with compat --directory {env:PLUGIN_DIR} --compile
commands = 
	poetry run pytest -vv {env:PLUGIN_DIR}/tests/
commands_post = 
	git checkout {env:PLUGIN_DIR}/pyproject.toml
	poetry lock --no-update --directory {env:PLUGIN_DIR}

